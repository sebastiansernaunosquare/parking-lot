<app-header></app-header>

<div class="container mt-4">
  <div class="row mb-5">
    <div class="col-md-8 mx-auto">
      @if (activeRaffle(); as raffle) {

      <div class="card shadow border-0 text-center">
        <div class="card-header bg-primary text-white py-3">
          <h4 class="mb-0 fw-bold">Active raffle: {{ raffle.period }}</h4>
        </div>

        <div class="card-body py-5">
          <h5 class="card-title text-muted mb-4">
            {{ raffle.totalSpots }} Total spots
          </h5>

          @if (isRegistered()) {
          <div class="alert alert-success d-inline-block px-5">
            <i class="bi bi-check-circle-fill fs-1 d-block mb-2"></i>
            <strong>You are participating in the raffle</strong>
            <p class="mb-0 small">Good luck</p>
          </div>
          } @else {
          <p class="lead">
            Registration is now open. Would you like to participate?
          </p>
          <button
            class="btn btn-primary btn-lg px-5 shadow-sm"
            (click)="register()"
            [disabled]="isLoading()"
          >
            @if (isLoading()) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Processing... } @else { I want to participate! }
          </button>
          }
        </div>
        <div class="card-footer text-muted small">
          The raffle will be carried out automatically at the close of the
          period.
        </div>
      </div>

      } @else {

      <div class="card shadow-sm border-0 bg-light text-center py-5">
        <div class="card-body">
          <i class="bi bi-calendar-x text-muted" style="font-size: 3rem"></i>
          <h4 class="mt-3">There are no active raffles</h4>
          <p class="text-muted">
            There is currently no open registration period. <br />
            Please check back later.
          </p>
        </div>
      </div>

      }
    </div>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>My History</h5>
    </div>

    <div class="list-group list-group-flush">
      @for (reg of history(); track reg.id) {

      <div
        class="list-group-item d-flex justify-content-between align-items-center py-3"
      >
        <div>
          <small class="text-muted">
            Registered on: {{ reg.registrationDate | date:'mediumDate' }}
          </small>
        </div>

        <div>
          @if (reg.isWinner) {
          <span class="badge bg-success py-2 px-3">
            <i class="bi bi-trophy-fill me-1"></i> You won a spot!
          </span>
          } @else {
          <span class="badge bg-secondary"> Not assigned </span>
          }
        </div>
      </div>

      } @empty {
      <div class="text-center py-4 text-muted">
        You have no participation history.
      </div>
      }
    </div>
  </div>
</div>
